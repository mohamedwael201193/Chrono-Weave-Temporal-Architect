import{BigNumber as e}from"@ethersproject/bignumber";import{Contract as r}from"@ethersproject/contracts";import{serialize as a}from"@ethersproject/transactions";import{base as i}from"../../chains/base.mjs";import{baseGoerli as t}from"../../chains/baseGoerli.mjs";import{baseSepolia as o}from"../../chains/baseSepolia.mjs";import{optimism as s}from"../../chains/optimism.mjs";import{optimismGoerli as m}from"../../chains/optimismGoerli.mjs";import{optimismSepolia as n}from"../../chains/optimismSepolia.mjs";import{zora as c}from"../../chains/zora.mjs";import{zoraSepolia as P}from"../../chains/zoraSepolia.mjs";import{zoraTestnet as f}from"../../chains/zoraTestnet.mjs";import{convertBigNumberish as h,toEthersUnsignedTransaction as d}from"../utils/ethers.mjs";const l=81457,p=168587773,F="0x420000000000000000000000000000000000000F",x=["function getL1Fee(bytes memory _data) external view returns (uint256)"],G=e=>[i.id,t.id,o.id,s.id,m.id,n.id,c.id,f.id,P.id,l,p].includes(e),u=async(r,a)=>{if(!G(r.chainId))throw new Error("Invalid chain ID for OP Stack gas estimation.");if(void 0===r.type&&(r.type=2),r.gasPrice&&(console.warn("`gasPrice` is not supported on this chain and will be ignored. Use `maxPriorityFeePerGas` and/or `maxFeePerGas` instead."),delete r.gasPrice),r.maxPriorityFeePerGas&&r.maxFeePerGas)return r;try{if(!r.maxPriorityFeePerGas){const e=await a.send("eth_maxPriorityFeePerGas",[]);r.maxPriorityFeePerGas=e}if(r.maxFeePerGas&&(console.warn("maxFeePerGas is specified without maxPriorityFeePerGas - this can result in hung transactions."),r.maxPriorityFeePerGas>=r.maxFeePerGas))throw new Error("Overridden maxFeePerGas is less than or equal to the calculated maxPriorityFeePerGas. Please set both values or maxPriorityFeePerGas alone for correct gas estimation.");if(!r.maxFeePerGas){const{lastBaseFeePerGas:i}=await a.getFeeData();if(!i)throw new Error("Unable to fetch baseFee for last block.");const t=e.from(i),o=t.mul(e.from(126)).div(e.from(100)).add(e.from(r.maxPriorityFeePerGas));r.maxFeePerGas=h(o)}}catch(e){throw new Error(`Failed to set gas price for OP stack transaction: ${e}.`)}return r};async function y(i,t){if(!i.chainId||i.chainId&&!G(i.chainId))return e.from(0);let o=e.from(0);try{const e=new r(F,x,t),s=d(i),m=a(s);o=await e.getL1Fee(m)}catch(e){}return o}export{x as OPTIMISM_STACK_GAS_PRICE_ORACLE_ABI,F as OPTIMISM_STACK_GAS_PRICE_ORACLE_ADDRESS,u as defaultGasForOpStack,y as estimateOpStackL1Gas,G as isOpStack};
